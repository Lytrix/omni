import json

messagePOD_CC0826A0 = [
  136,
  16,
  132,
  48,
  214,
  136,
  2,
  0,
  229,
  65,
  10,
  32,
  64,
  64,
  34,
  8,
  48,
  0,
  17,
  224,
  92,
  48,
  76,
  16,
  18,
  197,
  16,
  128,
  128,
  52,
  2,
  8,
  0,
  1,
  0,
  5,
  128,
  138,
  64,
  128,
  2,
  88,
  80,
  32,
  32,
  200,
  10,
  4,
  128,
  66,
  3,
  0,
  134,
  0,
  8,
  144,
  160,
  140,
  2,
  240,
  32,
  8,
  80,
  1,
  128,
  0,
  144,
  16,
  16,
  130,
  18,
  144,
  0,
  3,
  1,
  112,
  1,
  0,
  0,
  8,
  130,
  48,
  0,
  156,
  48,
  74,
  10,
  22,
  13,
  4,
  36,
  146,
  34,
  19,
  58,
  75,
  20,
  16,
  11,
  64,
  133,
  4,
  64,
  1,
  168,
  18,
  160,
  132,
  14,
  8,
  29,
  148,
  96,
  128,
  40,
  17,
  72,
  64,
  0,
  64,
  66,
  4,
  0,
  24,
  1,
  56,
  176,
  16,
  42,
  40,
  34,
  136,
  88,
  128,
  128,
  192,
  26,
  8,
  233,
  2,
  9,
  11,
  0,
  18,
  166,
  17,
  8,
  195,
  234,
  8,
  68,
  68,
  24,
  68,
  8,
  64,
  5,
  0,
  17,
  66,
  1,
  66,
  0,
  8,
  216,
  80,
  1,
  155,
  32,
  3,
  36,
  50,
  0,
  67,
  198,
  196,
  66,
  136,
  64,
  192,
  10,
  4,
  4,
  136,
  128,
  20,
  4,
  8,
  33,
  64,
  8,
  6,
  0,
  224,
  64,
  9,
  0,
  165,
  4,
  8,
  40,
  28,
  48,
  1,
  40,
  26,
  16,
  24,
  40,
  6,
  201,
  10,
  36,
  66,
  42,
  7,
  25,
  0,
  130,
  64,
  136,
  13,
  5,
  0,
  131,
  0,
  4,
  17,
  8,
  5,
  64,
  18,
  8,
  0,
  81,
  8,
  1,
  77,
  68,
  108,
  139,
  14,
  12,
  120,
  1,
  17,
  130,
  5,
  32,
  160,
  131,
  152,
  65,
  72,
  12,
  0,
  181,
  96,
  24,
  137,
  128,
  0,
  193,
  32,
  129,
  84,
  49,
  82,
  160,
  68,
  0,
  4,
  48,
  192,
  198,
  97,
  8,
  48,
  193,
  66,
  84,
  68,
  48,
  12,
  192,
  4,
  6,
  0,
  12,
  16,
  72,
  16,
  32,
  9,
  67,
  12,
  96,
  2,
  66,
  196,
  34,
  24,
  155,
  214,
  52,
  146,
  10,
  4,
  17,
  0,
  16,
  1,
  80,
  16,
  192,
  161,
  0,
  0,
  104,
  201,
  32,
  18,
  1,
  16,
  8,
  0,
  40,
  40,
  64,
  12,
  24,
  12,
  1,
  243,
  8,
  0,
  33,
  0,
  0,
  16,
  0,
  66,
  232,
  65,
  16,
  18,
  40,
  128,
  0,
  84,
  1,
  185,
  132,
  49,
  2,
  144,
  4,
  0,
  4,
  3,
  16,
  8,
  36,
  8,
  0,
  193,
  129,
  16,
  2,
  33,
  8,
  4,
  19,
  36,
  0,
  5,
  0,
  64,
  160,
  2,
  66,
  66,
  16,
  12,
  68,
  5,
  3,
  161,
  28,
  33,
  32,
  57,
  33,
  171,
  0,
  136,
  128,
  136,
  136,
  66,
  49,
  114,
  64,
  140,
  129,
  128,
  160,
  2,
  66,
  0,
  40,
  130,
  130,
  10,
  21,
  132,
  161,
  32,
  128,
  36,
  202,
  8,
  120,
  76,
  124,
  145,
  8,
  12,
  16,
  2,
  19,
  10,
  24,
  128,
  132,
  2,
  0,
  12,
  176,
  1,
  68,
  28,
  16,
  0,
  4,
  32,
  2,
  112,
  130,
  22,
  2,
  2,
  128,
  131,
  65,
  73,
  196,
  83,
  146,
  2,
  2,
  144,
  0,
  36,
  0,
  32,
  0,
  128,
  64,
  160,
  69,
  32,
  8,
  80,
  0,
  16,
  27,
  113,
  0,
  138,
  18,
  64,
  2,
  38,
  128,
  128,
  4,
  41,
  32,
  34,
  82,
  0,
  32,
  67,
  64,
  16,
  2,
  129,
  34,
  131,
  35,
  20,
  16,
  131,
  132,
  23,
  0,
  0,
  129,
  32,
  144,
  80]

word_CC078380 = [
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  65535,
  0,
  481,
  65054,
  0,
  65535,
  0,
  65535,
  285,
  65250,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  13,
  65522,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535,
  0,
  65535]

byte_CC078464 = [
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  255,
  0,
  0,
  255,
  40,
  215,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  5,
  250,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  1,
  254,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  1,
  254,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255,
  0,
  255]

dword_CC0781B8 = [
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295]


dword_CC078298 = [
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  3088,
  4294964207,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  0,
  4294967295,
  619,
  4294966676,
  4294967295,
  0]


with open('pdm-eu.h.json') as jsonFile:
    id2Names = json.loads(jsonFile.read())


def LOBYTE(target):
    n = 0
    return hex((target & (0xFF << (8 * n))) >> (8 * n))


def nullsub_6(dword):
    return dword


def set_CPSR_C0(a1):
    """..."""
    result = 'test'
    #result = __get_CPSR() & ~0xC0u | (a1 & 0xC0)
    #__set_CPSR(result)
    return result


def set_CPSR_C0_to_param(a1):
    """..."""
    result = 'test'
    #result = __get_CPSR() & ~0xC0u | (a1 & 0xC0)
    #__set_CPSR(result)
    return result


def getName(number):
    """Get text of used id field"""
    return id2Names["struct_0"].get(str(number))["name"]


def reportError(a1, a2, a3, a4):
    """Print error message"""
    errorMessage = 'error code: {}, {}, {},value: {}'.format(a1,
                                                             getName(a2),
                                                             getName(a3),
                                                             a4)
    print(errorMessage)
    return(errorMessage)


def reportErrorS(a1, a2, a3):
    """Print error message"""
    errorMessage = 'error code: {}, {}, {}'.format(a1,
                                                   getName(a2),
                                                   getName(a3))
    print(errorMessage)
    return(errorMessage)


def sub_C80D9348(result):
    byte_CC0829D4 = result
    return result


def sub_C80CB430(a1):
    a1 = convertHex2Decimal(a1)

    v1 = a1
    v2 = readWordSafe_CC078380(83)
    result = sub_C80D9348(1)
    if not v2 and v1:
        sub_C80D9348(0)
        result = reportErrorS(310, 0, 5)
    return v1, v2, result


def sub_C80D90AC(a1, v3):  # check bolus value?
    v5 = a1
    v5 =20
    if (a1 <= 0) or (v5 > 18):
        # Basal error
        reportError(360, 23, 5, v5)
        return 0
    # v5
    set_CPSR_C0(v3)
    if (dword_CC0781B8[2 * v5] + dword_CC0781B8[2 * v5 + 1] != -1):
        set_CPSR_C0_to_param(v3)
        # Max Bolus error
        reportError(360, 22, 1, v5)
        return 0
    v4 = dword_CC0781B8[2 * v5]
    set_CPSR_C0_to_param(v3)
    return v4, v5


def readWordSafe_CC078380(number):
    return word_CC078380[number]


def readSafe_CC078464_offset(number):
    return byte_CC078464[number]


def sub_C8108CE4(a1, a2):
    return sub_C8108BEC(a1, a2)


def sub_C8108BEC(result, a2):
    if (a2 != 1):
        if (a2 >= 1):
            if (result <= a2):
                result = result == a2
            elif a2 and (a2 - 1):
                if (a2 & convertHex2Decimal('0xE0000000')):
                    v2 = 1
                else:
                    a2 *= 8
                    v2 = 8
                while(1):
                    v3 = a2 >= convertHex2Decimal('0x10000000')
                    if (a2 < convertHex2Decimal('0x10000000')):
                        v3 = a2 >= result
                    if(v3):
                        break
                    a2 *= 16
                    v2 *= 16
                while(1):
                    v4 = a2 >= convertHex2Decimal('0x80000000')
                    if (a2 < convertHex2Decimal('0x80000000')):
                        v4 = a2 >= result
                    if(v4):
                        break
                    a2 *= 2
                    v2 *= 2
                v5 = 0
                while(1):
                    if (result >= a2):
                        result -= a2
                        v5 |= v2
                    if (result >= a2 >> 1):
                        result -= a2 >> 1
                        v5 |= v2 >> 1
                    if (result >= a2 >> 2):
                        result -= a2 >> 2
                        v5 |= v2 >> 2
                    if (result >= a2 >> 3):
                        result -= a2 >> 3
                        v5 |= v2 >> 3
                    v6 = result == 0
                    if (result):
                        v2 >>= 4
                        v6 = v2 == 0
                    if (v6):
                        break
                    a2 >>= 4
                result = v5
            else:
                if (a2 < convertHex2Decimal('0x10000')):
                    v7 = 0
                else:
                    a2 >>= 16
                    v7 = 16
                if (a2 >= convertHex2Decimal('0x100')):
                    a2 >>= 8
                    v7 += 8
                if (a2 >= convertHex2Decimal('0x10')):
                    a2 >>= 4
                    v7 += 4
                if (a2 <= 4):
                    v7 += a2 >> 1
                else:
                    #LOBYTE(v7) = v7 + 3
                    v7 = LOBYTE(v7) + 3 # probably wrong, but testing
                result >>= v7
        else:
            nullsub_6(result)
            result = 0
    return result


def sub_C80CBDD0(): # set v2
    v0 = cspi_read_record(convertHex2Decimal('0x13u')) # 19
    v3 = cspi_read_record(convertHex2Decimal('0x14u')) # 20
    v2 = 0
    if (v0):
        v2 = 64
    if (v3):
        v2 |= convertHex2Decimal('0x3Cu')
    return v2


def memset_0(listItems, start, end):
    #print(string, start, convertHex2Decimal(end))
    return listItems, start, end


def convertHex2Decimal(hexadecimal):
    if type(hexadecimal) == str:
        hexadecimal = hexadecimal.replace('u', '')
        hexadecimal = int(hexadecimal, 16)
    return hexadecimal


def sub_C80E8770(v2, v3):
    result = readSafe_CC078464_offset(151)
    if (result == 13 or result == 33 or result == 28 or result == 34):
        if (cspi_read_record('0x2Fu') == 1):
            result = sub_C80AB124(v1)
            if (v2):
                result = writeSafe_CC078464_offset(191, 1)
            elif (v3 == -1):
                result = writeSafe_CC078464_offset(191, 1)
        else:
            result = writeSafe_CC078464_offset(191, 1)
    return result


def LABEL_19(v18, v3):
    return writeSafe_CC078298(40, v18, v3)


def writeSafe_CC078298(offset, value, v3):
    _o = offset
    _v = value
    if (offset <= 28 or _o > 57):
        result = reportError(360, 15, 5, _o)
    else:
        _o -= 29
        set_CPSR_C0(v3)
        dword_CC078298[2 * _o] = _v
        dword_CC078298[2 * _o + 1] = ~_v
        result = set_CPSR_C0_to_param(v3)
    return result


def cspi_read4bytes(byteSet):
  return convertHex2Decimal(byteSet)

def main(messagePOD_CC0826A0, dword_CC02581C, byte_CC0829D4):
    print(convertHex2Decimal('0xF4240u'))
    print(convertHex2Decimal('0x1Du'))
    print(convertHex2Decimal('0x22u'))
    start =  sub_C80CB430('0x40u')
    v1 = start[0]
    print('v1= ', v1)
    v2 = start[1]
    print('v2= ', v2)
    memset_0(messagePOD_CC0826A0, 0, convertHex2Decimal('0x200u'))
    v3 = dword_CC02581C
    print('v3= ', v3)
    v0 = 100 * readWordSafe_CC078380(98)  # 98 = 65535 so v0 = 6553500
    print('v0= ', v0)
    v11 = readWordSafe_CC078380(97)  # = 0
    print('v11= ', v11)
    v4 = sub_C80D90AC(6, v3)
    print('v4= ', v4)
    # v5 and v6 not in origional on this place but assuming this:
    v5 = 6 # = a1 from subC80D90AC
    print('v5= ', v5)
    v6 = cspi_read4bytes('0x24u') # is this the given bolus?
    print('v6= ', v6)
    v18 = sub_C80D90AC(7, v3)
    print('v18= ', v18)
    v16 = readSafe_CC078464_offset(115)
    print('v16= ', v16)
    v19 = sub_C8108CE4(10000 * v1, v11)
    print('v19= ', v19)
    v15 = v0
    print('v15= ', v15)
    v20 = sub_C80CBDD0()  # read record
    print('v20= ', v20)
    sub_C80E8770(v2, v3)
    print('readSafe= ', readSafe_CC078464_offset(151))  # 255
    switchCase = readSafe_CC078464_offset(151)
    if switchCase == 3:  # 3u
        v19 = 10 * readSafe_CC078464_offset(157)
        v18 = 0
        v14 = 0
        v13 = 0
        v12 = 0
        v15 = 100 * readWordSafe_CC078380(99)
        v20 = 0
        LABEL_19(v18, v3)
    elif switchCase == 5: #5u
          v19 = 10 * readSafe_CC078464_offset(158)
          v18 = 0
          v14 = 0
          v13 = 0
          v12 = 0
          v15 = 100 * readWordSafe_CC078380(99)
          v20 = 0
          LABEL_19(v18, v3)
    elif switchCase == 13: #'0xDu'
        print('OxDu')
    elif switchCase == 33: #'0x21u'
        if(v18):
            v2 = sub_C80D90AC(6)
            v3 = sub_C80CF7D0(v2)
            v18 = sub_C8108CE4(10000 * v18, v11)
            v14 = sub_C810A21C(1800000000 * v16, 1800000000 * v16 >> 32, v18, 0)
            v13 = 1800 * v16
            v12 = sub_C80F1614() + 1800 * v16 + v3
        else:
            v14 = 0
            v13 = 0
            v12 = 0
        LABEL_19(v18, v3)
    elif switchCase == 28: #'0x1Cu'
        print('0x1Cu')
    elif switchCase == 34: #'0x22u'
        if (readWordSafe_CC078380(87)):
            v4 = sub_C80D90AC(6)
            v17 = sub_C80CF7D0(v4)
            if (readSafe_CC078464_offset(184) == 1):
                v18 = readSafe_CC078298(40)
                v13 = readSafe_CC078298(42)
                v14 = readSafe_CC078298(41)
                v12 = sub_C80F1614() + v17 + v13
            else:
                v18 = 10 * readWordSafe_CC078380(87)
                v12 = readSafe_CC078298(43) + v17
                v13 = v12 - sub_C80F1614() - v17
                v14 = sub_C810A21C(1000000 * v13, 1000000 * v13 >> 32, v18, 0)
                if (v14 <= 299999):
                    v14 = 300000
                    v13 = 300000 * v18 / convertHex2Decimal('0xF4240u')
                v12 = sub_C80F1614() + v13 + v17
            LABEL_19(v18, v3)
        else:
            v18 = 0
            v14 = 0
            v13 = 0
            v12 = 0
            writeSafe_CC078298(40, 0)
        writeSafe_CC078298(41, v14)
        writeSafe_CC078298(42, v13)
        writeSafe_CC078298(43, v12)
        v6 = cspi_read4bytes('0x24u')
        messagePOD_CC0826A0 = reverse_int_bytes(v6)
        v7 = messagePOD_CC0826A0[bolusMessageHelper_C80CF318(v19, v15, v18, v14, v13)]
        #*v7 = 23
        v7[1] = 13    #(base23 13= 1a hexadecimal is insulin schedule)
        v7[2] = v20   # v20 number of records = 14 = hexadecimal 0e
        v7[3] = BYTE1(v19) #nounce?
        v7[4] = v19 #02 for bolus)
        v7[5] = BYTE3(v15)
        v7[6] = v15 >> 16
        v7[7] = BYTE1(v15)
        v7[8] = v15
        v7[9] = BYTE1(v18)
        v7[10] = v18
        v7[11] = BYTE3(v14)
        v7[12] = v14 >> 16
        v7[13] = BYTE1(v14)
        v7[14] = v14
        len = v7 + 15 - messagePOD_CC0826A0
        if (sub_C80D44DC()):
            messagePOD_CC0826A0[5] = 4 * (sub_C80CB4A0(1) & 0xF) or messagePOD_CC0826A0[5] and 0xC3
            v9 = __ROR4__(messagePOD_CC0826A0[4] >> 10, 22) #(((unsigned __int16)len - 6) << 22),
            messagePOD_CC0826A0[4] = v9
            messagePOD_CC0826A0[4] = byteswap_uint16(v9)
            byte_CC082690 = 23
            result = messagePOD_CC0826A0_addCRC()
        else:
            sub_C80BF300(0, len(messagePOD_CC0826A0))
            sub_C80D9348(0)
            result = reportErrorS(310, 6, 5)
        return result
    elif switchCase == 34:#'0x1Du'
      v19 = 0
      v5 = 10 * readWordSafe_CC078380(87)
      if (v5 < readSafe_CC078298(40)):
        if (readWordSafe_CC078380(87) <= 0):
            v18 = 0
            v14 = 0
            v13 = 0
            v12 = 0
        else:
            v18 = 10 * readWordSafe_CC078380(87)
            v12 = readSafe_CC078298(43)
            v13 = v12 - sub_C80F1614()
            v14 = sub_C810A21C(1000000 * v13, 1000000 * v13 >> 32, v18, 0)
            if (v14 <= 299999):
                v14 = 300000
                v13 = 300000 * v18 / convertHex2Decimal('0xF4240u')
                v12 = sub_C80F1614() + v13
            else:
                v18 = readSafe_CC078298(40)
                v13 = readSafe_CC078298(42)
                v12 = sub_C80F1614() + v13
                v14 = readSafe_CC078298(41)
      LABEL_19(v18, v3)
    else:
        LABEL_19(v18, v3)
    #print(sub_C80CB430('0x40u'), v0, v11, v1, v18, v16, v19, v15, v20, sub_C80E8770(), )
    # v7 is body 
    # v7 = 0.5
    #print(v0, v1, v2, v3, v4, v5, v6, v7, #result, v9, #length, 
   #       v11, v12, v13, v14, v15, v16, v17, v18, v19, v20)

if __name__ == "__main__":
    byte_CC0829D4 = 0 # could be the unit amount to Bolus
    dword_CC02581C = 4194309
    main(messagePOD_CC0826A0, dword_CC02581C, byte_CC0829D4)
